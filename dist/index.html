<!doctype html>
<html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <script src="ace/ace.js"></script>
    <script src="nodes.js"></script>
    <script src="calcParser.js"></script>

    <style>
        @font-face {
            font-family: 'casadia';
            src: url("/fonts/casadia.ttf");
        }
    </style>

    <title>olc2-p1-2s2020</title>
</head>
<body style="background-color: #1E222A">
<!-- Dropdown Structure -->
<div id="text-editor"></div>
<nav>
    <div class="navbar-fixed">
        <nav>
            <div style="background-color: #2BBBAD" class="nav-wrapper">
                <a href="#!" class="brand-logo">OLC2 P1 2S2020</a>
                <ul class="right hide-on-med-and-down">
                    <li><a id="go-to-console">Console</a></li>
                    <li><a id="go-to-text-editor">Text Editor</a></li>
                </ul>
            </div>
        </nav>
    </div>
</nav>
<div class="row">
    <form class="col s12 m12 l12">
        <div class="row">
            <div class="input-field col s12 m5 l5">
                <div style="height: 80vh"  id="textarea">aver</div>
            </div>
            <div style="text-align: center" class="input-field col s12 m2 l2">
                <button id="translate" style="width: 80%; margin-top: 30vh" class="btn">Translate</button>
                <button id="run" style="width: 80%; margin-top: 5vh" class="btn">Run</button>
                <div class="input-field" style="background-color: white; width: 80%; margin-left: 10%; border-radius: 5px; border: none; ">
                <select onchange="GetExample(this.value)">
                    <option style="color: white; text-align: center" value="" disabled selected>EXAMPLES</option>
                    <option style="color: white" value="Expression.ts">Expression.ts</option>
                    <option style="color: white" value="FuncionesRescursivas.ts">FuncionesRecursivas.ts</option>
                    <option style="color: white" value="avl.ts">avl.ts</option>
                    <option style="color: white" value="matriz.ts">matriz.ts</option>
                </select>
                </div>
            </div>
            <div class="input-field col s12 m5 l5">
                <textarea style="height: 80vh; color: white" rows="10" id="translated" disabled></textarea>
            </div>
            <div id="console-header" class="input-field col s12">
                <h4 style="background-color: #2BBBAD; color: white; padding-top: 0.3em; padding-bottom: 0.3em">Console</h4>
                <textarea disabled style="height: 80vh; background-color: #2E3440; color: #FFF; font-family: casadia; white-space: pre-wrap;" rows="10"
                          id="console"></textarea>
            </div>
        </div>
    </form>
</div>
<script>
    function GetExample(index){
        const url = `https://raw.githubusercontent.com/PvasquezF/ArchivosPruebaOLC2/master/MatrioshTS-2s2020/${index}`;
        $.get(url, (data) => {
            var editor = ace.edit("textarea");
            editor.setValue(data);
        }, 'text');
    }

    document.addEventListener('DOMContentLoaded', function() {
        var elems = document.querySelectorAll('select');
        var instances = M.FormSelect.init(elems, options);
    });

    $(document).ready(() => {
        $('select').formSelect();


        var editor = ace.edit("textarea");
        editor.setTheme("ace/theme/nord_dark");
        editor.session.setMode("ace/mode/typescript");

        editor.setFontSize(16);

        editor.setValue('' +
            'let a = 5;\n' +
            '\n' +
            'for(let b = 10; b<=20; a++){\n' +
            '    console.log(a);\n' +
            '    if(a%2 == 0)\n' +
            '        b += a;\n' +
            '}');



        const scrollFactor = 500;
        function scrollToConsole() {
            $('html, body').animate({
                scrollTop: $("#console-header").offset().top
            }, scrollFactor);
        }

        function scrollToTextEditor() {
            $('html, body').animate({
                scrollTop: $("#text-editor").offset().top
            }, scrollFactor);
        }

        $('#go-to-console').click((e) => {
            e.preventDefault();
            scrollToConsole();
        });

        $('#go-to-text-editor').click((e) => {
            e.preventDefault();
            scrollToTextEditor();
        });

        $('#run').click((e) => {
            e.preventDefault();
            let c = $('#console');
            c.text('');
            let TXT = ast.TranslateStringsCompose(editor.getValue());
            $('#translated').val(TXT);
            let sentences = calc.parse(TXT);
            ast.ExecuteAST(sentences);
            c.html(ast.Console.log);

            scrollToConsole();
        });
    });
</script>
</body>

</html>
